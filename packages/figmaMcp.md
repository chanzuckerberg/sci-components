---
name: Figma MCP Integration
appliesTo:
  - glob: "src/**/*.{ts,tsx,mdx}"
priority: 90
---

# Context

- Use the Figma Dev Mode MCP server running locally at http://127.0.0.1:3845/mcp
- Always fetch design metadata from MCP before generating or editing components
- If Code Connect mappings exist for a Figma node, follow them instead of re-implementing

# Rules

1. **MCP Queries**
   - Use `get_code` to fetch React snippets for the selected Figma node.
   - Use `get_variable_defs` to pull tokens (color, spacing, typography, radius).
   - Use `get_code_connect_map` to check if a Code Connect mapping exists.

2. **Code Generation**
   - Default: React + TypeScript + Tailwind.
   - Place components under `src/components/{Group}/{Component}`.
   - PascalCase for filenames and component names.
   - Map Figma variant props → TS props (Type → variant, Size → size, State → state).
   - Infer boolean props from hidden layers (Disabled, Loading, Selected).
   - Accessibility: add semantic roles, aria labels from Figma text layers.

3. **Storybook**
   - Generate CSF 3 stories with `@storybook/react` imports.
   - Default story = `Playground`.
   - Add `States`/`Sizes` stories if variants exist.
   - Title format: `Design System/{Group}/{Component}`.

4. **Tokens**
   - Always prefer MCP-fetched Figma Variables over hardcoded values.
   - Use CSS custom properties `--ds-*` when possible.

5. **Safeguards**
   - Do not overwrite existing files unless pragma header exists:  
     `// @generated by mcp -- allow-overwrite`
   - If MCP returns a Code Connect snippet, surface that directly in output.

# Definition of Done

- Component/stories compile without errors.
- Storybook renders the new component with controls.
- No critical a11y violations.
- Matches Figma design (props + tokens) as per MCP data.
